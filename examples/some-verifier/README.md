# SoMe Web3 ID Verifier dApp and API

Checks social media credentials issued by the SoMe Web3 ID Issuer.
Also serves an API to the social media bots, where they can query they verification status of users.

Currently the two supported platforms are Telegram and Discord.

## API

### GET `/verifications/{platform}/{userId}`

Responds with a list of `Accounts`s and an optional `FullName` in JSON.

Example response:

```
{
    "accounts": [
        {
            "platform": "Telegram",
            "username": "TelegramUsername",
            "revoked": false
        },
        {
            "platform": "Discord",
            "username": "DiscordUsername#1234",
            "revoked": false
        }
    ],
    "full_name": {
        "first_name": "John",
        "last_name": "Doe"
    }
}
```

### POST `/verifications`

Adds a new verification, taking JSON parameter examplified by the following object.

- `proof`: web3 ID proof generated by a users wallet. Must include proofs from multiple verifiable credentials.
- `timestamp`: Date formatted as ISO string.

```
{
  "proof": {
    "presentationContext": "d99d2159f055cbfafac041e6313bf2fce0522eb5b5103e6bd59a67c3bdbe9580",
    "proof": {
      "created": "2023-08-29T11:59:04.956Z",
      "proofValue": [
        "81a302e4a8173fc3fbb0cf4a1c2b77dc69a91bb986719e4114c920cf789abfde8df2678291a742440b77ba51ba17def35375f548180151c78403753edaef3e03",
        "5cf9802d93f6b8025e8e3d40bb82d67defb0cb429dfd301efffb6862035b744736247d34fd53ea6a95f24ca84232a6fadc72b78d5d72486a0cffd4397a8ae70c"
      ],
      "type": "ConcordiumWeakLinkingProofV1"
    },
    "type": "VerifiablePresentation",
    "verifiableCredential": [
      ...
    ]
  },
  "timestamp": "2023-08-29T11:59:02.720Z"
}
```

### PATCH `/verifications`

Removes a verification. Takes a JSON parameter similar to as the corresponding `POST` endpoint, but will reject any proof made from anything else than 1 verifiable credential.


## Docker image

The docker image with the `some-verifier` can be built using the provided
[`Dockerfile`](./scripts/build.Dockerfile).

```console
podman build     --build-arg build_image=rust:1.67-buster --build-arg frontend_build_image=node:16-slim --build-arg base_image=debian:buster -f examples/some-verifier/scripts/build.Dockerfile .
```

running from the **root** of the repository.

This will produce a docker image with a binary `some-verifier` that is located in
`/usr/local/bin`. That is meant to be the entrypoint of the image.

### Configuration options for the image.

The following configuration options are supported

      --node <ENDPOINT>
          GRPC V2 interface of the node. [env: SOME_VERIFIER_NODE=] [default: http://localhost:20000]
      --network <NETWORK>
          Network to which the verifier is connected. [env: SOME_VERIFIER_NETWORK=] [default: testnet]
      --telegram-registry <TELEGRAM_REGISTRY>
          Address of the Telegram registry smart contract. [env: SOME_VERIFIER_TELEGRAM_REGISTRY_ADDRESS=]
      --discord-registry <DISCORD_REGISTRY>
          Address of the Discord registry smart contract. [env: SOME_VERIFIER_DISCORD_REGISTRY_ADDRESS=]
      --discord-bot-token <DISCORD_BOT_TOKEN>
          Discord bot token for looking up usernames. [env: SOME_VERIFIER_DISCORD_BOT_TOKEN=]
      --db <DB_CONFIG>
          Database connection string. [env: SOME_VERIFIER_DB_STRING=] [default: "host=localhost dbname=some-verifier user=postgres password=password port=5432"]
      --log-level <LOG_LEVEL>
          Maximum log level. [env: SOME_VERIFIER_LOG_LEVEL=] [default: info]
      --request-timeout <REQUEST_TIMEOUT>
          Request timeout (both of request to the node and server requests) in milliseconds. [env: SOME_VERIFIER_REQUEST_TIMEOUT=] [default: 5000]
      --port <LISTEN_ADDRESS>
          Address where the server will listen on. [env: SOME_VERIFIER_LISTEN_ADDRESS=] [default: 0.0.0.0:80]
